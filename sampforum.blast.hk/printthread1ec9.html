<!DOCTYPE html><!-- start: printthread -->
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title> [Include] weapon-config.inc - Damage system with many features - Printable Version</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="description" content="This is an include that provides a more consistent and responsive damage system with many new features. It's pretty much plug-and-play if you don't have any filterscripts that interfere with the healt" />
<link rel="canonical" href="showthread1ec9.html?tid=563387" />
</head>
<body>
<div>

<div><a href="index-2.html"><img src="images/bootbb/logo_forum.gif" alt="SA-MP Forums Archive" title="SA-MP Forums Archive" /></a></div>


<div>
<span class="largetext"> <a href="showthread1ec9.html?tid=563387">[Include] weapon-config.inc - Damage system with many features</a> - Printable Version</span><br />
<br />
+- SA-MP Forums Archive (<em>https://sampforum.blast.hk</em>)<br />
<!-- start: printthread_nav -->
+-- Forum: SA-MP Scripting and Plugins (<i>https://sampforum.blast.hk/forumdisplay.php?fid=8</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+--- Forum: Filterscripts (<i>https://sampforum.blast.hk/forumdisplay.php?fid=17</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+---- Forum: Includes (<i>https://sampforum.blast.hk/forumdisplay.php?fid=83</i>)<br />
<!-- end: printthread_nav -->
+---- Thread:  [Include] weapon-config.inc - Damage system with many features (<em>/showthread.php?tid=563387</em>)<br />
<br />
<!-- start: printthread_multipage -->
<div class="multipage">Pages:  <!-- start: printthread_multipage_page_current -->
1
<!-- end: printthread_multipage_page_current --><!-- start: printthread_multipage_page -->
<a href="printthread1aa5.html?tid=563387&amp;page=2">2</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread84bb.html?tid=563387&amp;page=3">3</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread5406.html?tid=563387&amp;page=4">4</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread77b5.html?tid=563387&amp;page=5">5</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread8697.html?tid=563387&amp;page=6">6</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreadbc0a.html?tid=563387&amp;page=7">7</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreada1e9-2.html?tid=563387&amp;page=8">8</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread2778.html?tid=563387&amp;page=9">9</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread0a3f-2.html?tid=563387&amp;page=10">10</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread75f9.html?tid=563387&amp;page=11">11</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread44d9-2.html?tid=563387&amp;page=12">12</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread804c.html?tid=563387&amp;page=13">13</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread3abd.html?tid=563387&amp;page=14">14</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreadd54d.html?tid=563387&amp;page=15">15</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreada3d8.html?tid=563387&amp;page=16">16</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread7b65.html?tid=563387&amp;page=17">17</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreadab2a.html?tid=563387&amp;page=18">18</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthreadd7a1.html?tid=563387&amp;page=19">19</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread759f.html?tid=563387&amp;page=20">20</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread7bdc.html?tid=563387&amp;page=21">21</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread0b56.html?tid=563387&amp;page=22">22</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread6d01.html?tid=563387&amp;page=23">23</a>
<!-- end: printthread_multipage_page --><!-- start: printthread_multipage_page -->
<a href="printthread7101.html?tid=563387&amp;page=24">24</a>
<!-- end: printthread_multipage_page --></div>
<!-- end: printthread_multipage --></div>


<div><br /><hr size="1" /><!-- start: printthread_post -->
weapon-config.inc - Damage system with many features - <a href="membercec9.html?action=profile&amp;uid=23640">Slice</a> -  15.02.2015
<br />
<br />
This is an include that provides a more consistent and responsive damage system with many new features.<br />
<br />
It's pretty much plug-and-play if you don't have any filterscripts that interfere with the health or death events.<br />
<br />
<font size="5">Demo server</font><br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px solid #C2C2C2;
		width: 800px;
		height: 114px;
		text-align: left;
		overflow: auto">HostName: Slice's test server
Address:  ulclan.com:1234
Players:  0 / 100
Ping:     42
Mode:     Slice's test gm
Map:      San Andreas</pre>
</div><font size="5">Features</font><br />
<ul><li><b>Server-side health</b><ul><li>Impossible to use health hacks on lagcomp mode</li>
<li>Any type of damage can be modified/prevented, even falling 1000m from the sky</li>
<li>Vending machines are controlled server-side (buildings removed and objects created)</li>
<li>Paused players can be killed (with death animations) and their HP bars always show the correct values</li>
</ul></li>
<li><b>Destroy vehicles with a passenger but no driver</b></li>
<li><b>Custom falling damage (optional)</b><ul><li>Adjust the damage and at which speed a player will die</li>
</ul></li>
<li><b>Sounds and on-screen TextDraw indicators of damage given/taken</b><ul><li>Also shows another player's damage feed when spectating</li>
</ul></li>
<li><b>New weapon types detected</b>:<ul><li><font face="Courier New">WEAPON_PISTOLWHIP</font> - When you punch someone with a gun</li>
<li><font face="Courier New">WEAPON_VEHICLE_M4</font> - Vehicles with M4 guns (e.g. Rustler)</li>
<li><font face="Courier New">WEAPON_VEHICLE_MINIGUN</font> - Vehicles with miniguns (e.g. Hunter)</li>
<li><font face="Courier New">WEAPON_HELIBLADES</font> - Helikill</li>
<li><font face="Courier New">WEAPON_CARPARK</font> - When you park your car on someone</li>
</ul></li>
<li><b>Extensive sanity checking on shots:</b><ul><li>Modified weapon.dat is automatically detected</li>
<li>Shot vector, player distance, and much more is examined</li>
<li>A callback is invoked for each so-called "rejected hit" so that the player is informed. A few of these are:<ul><li>Inflicting damage when already dead (due to lag)</li>
<li>Hit a player too far from the shot hit position (due to severe lag or cheating)</li>
<li>Hitting/shooting too fast (due to severe lag or cheating)</li>
</ul></li>
</ul></li>
<li><b>Modify every weapon's damage amount</b><ul><li>To a single value</li>
<li>To multiple values depending on the shot distance</li>
<li>With custom logic in a callback, for example:<ul><li>Increase damage for headshots</li>
<li>Increase/lower damage for combos</li>
<li>Lower damage for c-bug rapid fire</li>
</ul></li>
</ul></li>
<li><b>Knife sync fixed in both lagcomp and no-lagcomp</b></li>
<li><b>New death atnimations and respawn logic</b><ul><li>Customize respawn time globally and for each death</li>
<li>Fully customizable animations, with a nice set of defaults</li>
<li>Different animation depending on weapon/bodypart, for example:<ul><li>Headshots make you fall back with both hands in your face</li>
<li>Shotgun kills make you fly backward like in GTA:VC (unless killed from behind)</li>
</ul></li>
</ul></li>
</ul>
<font size="5">Download</font><br />
<br />
<b>GitHub</b>: <a href="https://github.com/oscar-broman/samp-weapon-config" target="_blank">https://github.com/oscar-broman/samp-weapon-config</a>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="memberd8cb.html?action=profile&amp;uid=231023">Skully82</a> -  15.02.2015
<br />
<br />
Another Awesome Relases Of You,Slice!<br />
Amazing work,Well done
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member407a.html?action=profile&amp;uid=222108">Abagail</a> -  15.02.2015
<br />
<br />
Second. Great release! Hopefully this will end the era of health hacking in SA-MP.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Respuesta: weapon-config.inc - Damage system with many features - <a href="member6d0b.html?action=profile&amp;uid=83068">Adoniiz</a> -  15.02.2015
<br />
<br />
Nice release, Slice. I like the anti hh. thanks
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member13fe.html?action=profile&amp;uid=108398">Admigo</a> -  15.02.2015
<br />
<br />
Looks nice<img alt="" border="0" class="inlineimg" src="images/smilies/wink.png" title="Wink"/>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="membere72f.html?action=profile&amp;uid=235955">Ritzy2K</a> -  15.02.2015
<br />
<br />
Nice... <img alt="" border="0" class="inlineimg" src="images/smilies/biggrin.png" title="Cheesy"/> its gonna help a lot <img alt="" border="0" class="inlineimg" src="images/smilies/smile.png" title="Smiley"/> specially to tdm dm...and cnr..
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member2dd7.html?action=profile&amp;uid=124473">GiamPy.</a> -  15.02.2015
<br />
<br />
I like it.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="memberbf87.html?action=profile&amp;uid=214776">Crayder</a> -  15.02.2015
<br />
<br />
Great! Love it!
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member407a.html?action=profile&amp;uid=222108">Abagail</a> -  15.02.2015
<br />
<br />
That is some very complex, and lengthy code. How long did it take you to write the include?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="membercec9.html?action=profile&amp;uid=23640">Slice</a> -  15.02.2015
<br />
<br />
It took quite a while to develop, since I didn't stop until the animations looked perfect! Though I still have some more things I want to add.<br />
<br />
Binaries will be officially released for SKY soon.<br />
<br />
In the mean time, try this: <a href="http://server.ulclan.com/SKY.so" target="_blank">http://server.ulclan.com/SKY.so</a>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member1708.html?action=profile&amp;uid=184410">PT</a> -  15.02.2015
<br />
<br />
The health bar bigger is because the knife bug?<br />
<br />
Nice work dude!
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member04b2.html?action=profile&amp;uid=129303">PaulDinam</a> -  15.02.2015
<br />
<br />
Using wide screen fix mod for gta sa will cause this:<br />
<img alt="" border="0" src="http://i.imgur.com/Z4NpxMQ.png"/>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="membercec9.html?action=profile&amp;uid=23640">Slice</a> -  15.02.2015
<br />
<br />
How exactly does wide screen need to be fixed?<br />
<br />
Either way, is there a way to detect that mode by reading the camera mode or vectors?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member04b2.html?action=profile&amp;uid=129303">PaulDinam</a> -  15.02.2015
<br />
<br />
I don't think so, this is an old ASI mod for GTA.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="memberede6.html?action=profile&amp;uid=47313">Kyle</a> -  15.02.2015
<br />
<br />
<div style="margin:20px; margin-top:5px; ">
<div class="smallfont" style="margin-bottom:2px">Quote:</div>
<table border="0" cellpadding="6" cellspacing="0" width="100%">
<tr>
<td class="alt2" style="border: 1px solid #C2C2C2; font-size: 8pt;">
<div>
					Originally Posted by <strong>Slice</strong><br />
<a href="showthreadad35-2.html?pid=3372331#pid3372331" rel="nofollow"><img alt="View Post" border="0" class="inlineimg" src="images/buttons/viewpost.gif"/></a><br />
</div>
<div style="font-style:italic">How exactly does wide screen need to be fixed?<br />
<br />
Either way, is there a way to detect that mode by reading the camera mode or vectors?</div>
</td>
</tr>
</table>
</div>GetPlayerCameraAspectRatio.<br />
<br />
Will return 0.0000 for WIDESCREEN and 0.333333 for NON-WIDESCREEN.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="membercec9.html?action=profile&amp;uid=23640">Slice</a> -  15.02.2015
<br />
<br />
He's talking about some CLEO, which by the way makes you impossible to hit on non-lagcomp servers and fucks up rocket launcher shoot vectors.<br />
<br />
I suppose the aspect ratio should be another value for it. Could someone look into that?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="member04b2.html?action=profile&amp;uid=129303">PaulDinam</a> -  15.02.2015
<br />
<br />
<b>1.776470</b> is returned when using this CLEO mod, you think perhaps you could modify the include to detect whether a player is using it or not?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="memberbf87.html?action=profile&amp;uid=214776">Crayder</a> -  15.02.2015
<br />
<br />
Since you create a custom bar, I think you could add a define for the color. Like WC_HEALTH_COLOR. By default it'd be the normal color.<br />
<br />
Or, you could use this color array and set the bar to (floatround(health)-1).<br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">pawn Code:</div>
<pre class="alt2" style="margin:0px; padding:6px; border: 1px solid #C2C2C2; width:800px; height:231px; overflow:auto"><div dir="ltr" style="text-align:left;"><div class="pawn" style="font-family:monospace;"><span style="color: #2222BB;">new</span> RGY<span style="color: #000000;">[</span><span style="color: #000000;">100</span><span style="color: #000000;">]</span> <span style="color: #000000;">=</span><br/><span style="color: #000000;">{</span><br/>    0xFF0000FF,0xFF0500FF,0xFF0A00FF,0xFF0F00FF,0xFF1400FF,0xFF1900FF,0xFF1E00FF,0xFF2300FF,0xFF2800FF,0xFF2D00FF,<br/>    0xFF3300FF,0xFF3800FF,0xFF3D00FF,0xFF4200FF,0xFF4700FF,0xFF4C00FF,0xFF5100FF,0xFF5600FF,0xFF5B00FF,0xFF6000FF,<br/>    0xFF6600FF,0xFF6B00FF,0xFF7000FF,0xFF7500FF,0xFF7A00FF,0xFF7F00FF,0xFF8400FF,0xFF8900FF,0xFF8E00FF,0xFF9300FF,<br/>    0xFF9900FF,0xFF9E00FF,0xFFA300FF,0xFFA800FF,0xFFAD00FF,0xFFB200FF,0xFFB700FF,0xFFBC00FF,0xFFC100FF,0xFFC600FF,<br/>    0xFFCC00FF,0xFFD100FF,0xFFD600FF,0xFFDB00FF,0xFFE000FF,0xFFE500FF,0xFFEA00FF,0xFFEF00FF,0xFFF400FF,0xFFF900FF,<br/>    0xFFFF00FF,0xF9FF00FF,0xF4FF00FF,0xEFFF00FF,0xEAFF00FF,0xE4FF00FF,0xDFFF00FF,0xDAFF00FF,0xD5FF00FF,0xD0FF00FF,<br/>    0xCAFF00FF,0xC5FF00FF,0xC0FF00FF,0xBBFF00FF,0xB6FF00FF,0xB0FF00FF,0xABFF00FF,0xA6FF00FF,0xA1FF00FF,0x9CFF00FF,<br/>    0x96FF00FF,0x91FF00FF,0x8CFF00FF,0x87FF00FF,0x82FF00FF,0x7CFF00FF,0x77FF00FF,0x72FF00FF,0x6DFF00FF,0x68FF00FF,<br/>    0x62FF00FF,0x5DFF00FF,0x58FF00FF,0x53FF00FF,0x4EFF00FF,0x48FF00FF,0x43FF00FF,0x3EFF00FF,0x39FF00FF,0x34FF00FF,<br/>    0x2EFF00FF,0x29FF00FF,0x24FF00FF,0x1FFF00FF,0x1AFF00FF,0x14FF00FF,0x0FFF00FF,0x0AFF00FF,0x05FF00FF,0x00FF00FF<br/><span style="color: #000000;">}</span>;</div></div></pre>
</div>
100 colors, fade from green to yellow to red. <img alt="" border="0" class="inlineimg" src="images/smilies/biggrin.png" title="Cheesy"/><br />
<br />
<br />
<br />
<br />
<br />
Edit: My server keeps crashing, is it because it is 0.3.7? Also, the bar is pretty wide (tall).
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="membercec9.html?action=profile&amp;uid=23640">Slice</a> -  16.02.2015
<br />
<br />
0.3.7 is not supported by SKY yet. I'll deal with it as fast as I can.<br />
<br />
Could you attach gdb to the process and print a backtrace of the crash?
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: weapon-config.inc - Damage system with many features - <a href="memberbf87.html?action=profile&amp;uid=214776">Crayder</a> -  16.02.2015
<br />
<br />
<div style="margin:20px; margin-top:5px; ">
<div class="smallfont" style="margin-bottom:2px">Quote:</div>
<table border="0" cellpadding="6" cellspacing="0" width="100%">
<tr>
<td class="alt2" style="border: 1px solid #C2C2C2; font-size: 8pt;">
<div>
					Originally Posted by <strong>Slice</strong><br />
<a href="showthreadd27a.html?pid=3372417#pid3372417" rel="nofollow"><img alt="View Post" border="0" class="inlineimg" src="images/buttons/viewpost.gif"/></a><br />
</div>
<div style="font-style:italic">0.3.7 is not supported by SKY yet. I'll deal with it as fast as I can.<br />
<br />
Could you attach gdb to the process and print a backtrace of the crash?</div>
</td>
</tr>
</table>
</div>It only crashes when I'm in game, and I can't connect to the server (or even query it) while gdb is attached. Lol, alternative?<br />
<br />
<br />
EDIT: ALso, I can't run the server from the gdb console. It says server.cfg could not be run (and I get the intro stuff).
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --></div>

</div>
</body>
</html>
<!-- end: printthread -->