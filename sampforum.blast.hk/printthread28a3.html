<!DOCTYPE html><!-- start: printthread -->
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<title> Serious Discussion about TIMERS! - Printable Version</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="description" content="Hello everyone, I really want to do something like this: Code: public OnPlayerConnect(playerid) { SetTimerEx(funcname[], 650, true:flag, &quot;d&quot;, playerid); //Example: SetTimerEx(funcname[], 650, true:AUT" />
<link rel="canonical" href="showthread28a3.html?tid=662422" />
</head>
<body>
<div>

<div><a href="index-2.html"><img src="images/bootbb/logo_forum.gif" alt="SA-MP Forums Archive" title="SA-MP Forums Archive" /></a></div>


<div>
<span class="largetext"> <a href="showthread28a3.html?tid=662422">Serious Discussion about TIMERS!</a> - Printable Version</span><br />
<br />
+- SA-MP Forums Archive (<em>https://sampforum.blast.hk</em>)<br />
<!-- start: printthread_nav -->
+-- Forum: SA-MP Scripting and Plugins (<i>https://sampforum.blast.hk/forumdisplay.php?fid=8</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+--- Forum: Scripting Help (<i>https://sampforum.blast.hk/forumdisplay.php?fid=12</i>)<br />
<!-- end: printthread_nav --><!-- start: printthread_nav -->
+---- Forum: Discussion (<i>https://sampforum.blast.hk/forumdisplay.php?fid=84</i>)<br />
<!-- end: printthread_nav -->
+---- Thread:  Serious Discussion about TIMERS! (<em>/showthread.php?tid=662422</em>)<br />
<br />
</div>


<div><br /><hr size="1" /><!-- start: printthread_post -->
Serious Discussion about TIMERS! - <a href="member5e6a.html?action=profile&amp;uid=306502">NexyAG</a> -  31.12.2018
<br />
<br />
Hello everyone, I really want to do something like this:<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px solid #C2C2C2;
		width: 800px;
		height: 130px;
		text-align: left;
		overflow: auto">public OnPlayerConnect(playerid)
{
	SetTimerEx(funcname[], 650, true:flag, "d", playerid);
	//Example:
	SetTimerEx(funcname[], 650, true:AUTO_KILL_ON_PLAYER_DISCONNECT, "d", playerid);
	return 1;
}</pre>
</div>I'm really wondering how can I make timer that kills when player disconnect in this case?<br />
I know that i can create some custom function where i can make enum and than for each started player timer i give a some ++ increment for createdtimers and then just kill all through loop through enum, but that is not so efficient bcuz i cannot know if it is player timer, even if i do sth like flag, i need your opinion <img alt="" border="0" class="inlineimg" src="images/smilies/confused.gif" title="huh"/>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member2209.html?action=profile&amp;uid=287764">CantBeJohn</a> -  01.01.2019
<br />
<br />
So uh, you're looking to do this?:<br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">PHP Code:</div>
<div class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px solid #C2C2C2;
		width: 800px;
		height: 242px;
		text-align: left;
		overflow: auto">
<code style="white-space:nowrap">
<!-- php buffer start --><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">new
<br/>    </span><span style="color: #0000BB">p_timername</span><span style="color: #007700">[</span><span style="color: #0000BB">MAX_PLAYERS</span><span style="color: #007700">];

<br/>public </span><span style="color: #0000BB">OnPlayerConnect</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">)
<br/>{
<br/>    </span><span style="color: #0000BB">p_timername</span><span style="color: #007700">[</span><span style="color: #0000BB">playerid</span><span style="color: #007700">] = </span><span style="color: #0000BB">SetTimerEx</span><span style="color: #007700">(. . .); </span><span style="color: #FF8000">// Your SetTimerEx here, SetTimerEx returns Timer IDs.
<br/>    </span><span style="color: #007700">return </span><span style="color: #0000BB">1</span><span style="color: #007700">;
<br/>}

<br/>public </span><span style="color: #0000BB">OnPlayerDisconnect</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">, </span><span style="color: #0000BB">reason</span><span style="color: #007700">)
<br/>{
<br/>    </span><span style="color: #0000BB">KillTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">p_timername</span><span style="color: #007700">[</span><span style="color: #0000BB">playerid</span><span style="color: #007700">]); </span><span style="color: #FF8000">// Kill that timer for the specific player.
<br/>    </span><span style="color: #007700">return </span><span style="color: #0000BB">1</span><span style="color: #007700">;
<br/>} 
<br/></span><span style="color: #0000BB"></span>
</span>
</code><!-- php buffer end -->
</code>
</div>
</div>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member2209.html?action=profile&amp;uid=287764">CantBeJohn</a> -  01.01.2019
<br />
<br />
<div style="margin:20px; margin-top:5px; ">
<div class="smallfont" style="margin-bottom:2px">Quote:</div>
<table border="0" cellpadding="6" cellspacing="0" width="100%">
<tr>
<td class="alt2" style="border: 1px solid #C2C2C2; font-size: 8pt;">
<div>
					Originally Posted by <strong>Y_Less</strong><br />
<a href="showthreadeb99.html?pid=4074738#pid4074738" rel="nofollow"><img alt="View Post" border="0" class="inlineimg" src="images/buttons/viewpost.gif"/></a><br />
</div>
<div style="font-style:italic">ptask</div>
</td>
</tr>
</table>
</div>To add to what Y_Less means; pTask is a thing with y_timers. So, use y_timers.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member5e6a.html?action=profile&amp;uid=306502">NexyAG</a> -  01.01.2019
<br />
<br />
CantBeJohn, you did not understand or better said i did not explained well, i know that with creating pvar than assigning that pvar to timer than when player disconnect just use killtimer(pvar), but i need timer to kill itself automatically, without this, it often happens to forget to kill timer and boom...<br />
I know about y_timers but i do not know if they have this feature mentioned above ( kill ptask when player dc without any code needed by me )<br />
EDIT : Lemme explain better:<br />
I have LoginPlayer function, i need this timer to be executed when pconnect but if player dc before timer executed kill it automatically<br />
EDIT 2 : Lemme write code to even more explain:<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px solid #C2C2C2;
		width: 800px;
		height: 370px;
		text-align: left;
		overflow: auto">new PTimer[MAX_PLAYERS][500];
new UsedTimers[MAX_PLAYERS] = -1;

public OnPlayerConnect(playerid)
{
	SetPlayerTimer("LoginPlayer", 8000, false, "i", playerid);
}

public SetPlayerTimer(code..)
{
	PTimer[playerid][UsedTimers[playerid]] = SetTimerEx("LoginPlayer", 8000, false, "i", playerid);
	UsedTimers[playerid]++;
}

public OnPlayerDisconnect(playerid, reason)
{
	for(new i=0; i &lt; UsedTimers[playerid]; i++)
	{
		KillTimer(PTimer[playerid][i]);
		UsedTimers[playerid] = -1;
	}
}</pre>
</div>But this code above uses alot of memory ( i suppose ) and isn't so efficient bcuz timer id may be number far greater than 500 in this case...<br />
I have some idea with enums without using arrays but still its not efficient enough
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member0e5e.html?action=profile&amp;uid=260190">Spmn</a> -  01.01.2019
<br />
<br />
Use y_timers' ptask or any plugin that provides per-player timers.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member705e.html?action=profile&amp;uid=193537">IllidanS4</a> -  01.01.2019
<br />
<br />
You can use <a href="showthread6947.html?tid=659714" target="_blank">PawnPlus</a> to create a per-player <font face="Courier New">Map</font> or <font face="Courier New">List</font>, then use <font face="Courier New">task_ms</font> to represent the waiting task, create a new handle to it via <font face="Courier New">handle_new</font>, call <font face="Courier New">handle_acquire</font> on the handle, and store it in the map or list. Then, when the player disconnects, call <font face="Courier New">map_delete_deep</font> or <font face="Courier New">list_delete_deep</font>. This will delete the per-player collection and all its contents, thus release the handles and in turn destroy all tasks stored there, even though they were not completed yet.<br />
<br />
Waiting on such a task will be cancelled and no further code will run.
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member5e6a.html?action=profile&amp;uid=306502">NexyAG</a> -  01.01.2019
<br />
<br />
<div style="margin:20px; margin-top:5px; ">
<div class="smallfont" style="margin-bottom:2px">Quote:</div>
<table border="0" cellpadding="6" cellspacing="0" width="100%">
<tr>
<td class="alt2" style="border: 1px solid #C2C2C2; font-size: 8pt;">
<div>
					Originally Posted by <strong>IllidanS4</strong><br />
<a href="showthreadb6b3.html?pid=4074806#pid4074806" rel="nofollow"><img alt="View Post" border="0" class="inlineimg" src="images/buttons/viewpost.gif"/></a><br />
</div>
<div style="font-style:italic">You can use <a href="showthread6947.html?tid=659714" target="_blank">PawnPlus</a> to create a per-player <font face="Courier New">Map</font> or <font face="Courier New">List</font>, then use <font face="Courier New">task_ms</font> to represent the waiting task, create a new handle to it via <font face="Courier New">handle_new</font>, call <font face="Courier New">handle_acquire</font> on the handle, and store it in the map or list. Then, when the player disconnects, call <font face="Courier New">map_delete_deep</font> or <font face="Courier New">list_delete_deep</font>. This will delete the per-player collection and all its contents, thus release the handles and in turn destroy all tasks stored there, even though they were not completed yet.<br />
<br />
Waiting on such a task will be cancelled and no further code will run.</div>
</td>
</tr>
</table>
</div>I'm actually alredy using PawnPlus since the very beginning of the plugin, i was using only 1% of it ( wait_ms haha )
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --><!-- start: printthread_post -->
Re: Serious Discussion about TIMERS! - <a href="member8713.html?action=profile&amp;uid=304261">B3x7K</a> -  18.01.2019
<br />
<br />
pTask or SetTimerEx...<br />
<br />
Just<br />
<br />
timer[playeird] = SetTimerEx bla bla on player connect.<br />
<br />
then<br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">PHP Code:</div>
<div class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px solid #C2C2C2;
		width: 800px;
		height: 210px;
		text-align: left;
		overflow: auto">
<code style="white-space:nowrap">
<!-- php buffer start --><code><span style="color: #000000">
<span style="color: #0000BB"></span><span style="color: #007700">public </span><span style="color: #0000BB">OnPlayerDisconnect</span><span style="color: #007700">(</span><span style="color: #0000BB">playerid</span><span style="color: #007700">, </span><span style="color: #0000BB">reason</span><span style="color: #007700">)
<br/>{
<br/>    for(new </span><span style="color: #0000BB">i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">; </span><span style="color: #0000BB">i </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">UsedTimers</span><span style="color: #007700">[</span><span style="color: #0000BB">playerid</span><span style="color: #007700">]; </span><span style="color: #0000BB">i</span><span style="color: #007700">++)
<br/>    {
<br/>        </span><span style="color: #0000BB">KillTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">PTimer</span><span style="color: #007700">[</span><span style="color: #0000BB">playerid</span><span style="color: #007700">][</span><span style="color: #0000BB">i</span><span style="color: #007700">]);
<br/>                </span><span style="color: #FF8000">// Are you lol?, if you put this on loop, it stops looping because variable i greater than -1.
<br/>        //UsedTimers[playerid] = -1;
<br/>    </span><span style="color: #007700">}
<br/>       </span><span style="color: #FF8000">//place in here, because if the variable i is greater than your UsedTimers, then the script continue read this until return 1;
<br/>        </span><span style="color: #0000BB">UsedTimers</span><span style="color: #007700">[</span><span style="color: #0000BB">playerid</span><span style="color: #007700">] = -</span><span style="color: #0000BB">1</span><span style="color: #007700">;
<br/>        return </span><span style="color: #0000BB">1</span><span style="color: #007700">;
<br/>} 
<br/></span><span style="color: #0000BB"></span>
</span>
</code><!-- php buffer end -->
</code>
</div>
</div>
<br />
<br />
<hr size="1" />
<!-- end: printthread_post --></div>

</div>
</body>
</html>
<!-- end: printthread -->